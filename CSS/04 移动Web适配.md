# 移动web的开发方式

运行 web 页面的显示设备，从数十上百英寸的企业大屏到 20 英寸左右的桌面 PC 再到五六英寸的手持智能终端，有各种大小的屏幕类型。

跨屏适配的需求，根据业务类型，一般有两种 UI 设计方案：

- 根据屏幕宽度，UI 布局弹性伸缩或流动。这种方式被称为**响应式设计**(Responsive Design)；

- 把屏幕按宽度范围分为有限的几个区段，为每个区段定制固定的 UI，相当于为专门的设备设计专门的 UI。这种方式被称为**自适应设计**(Adaptive Design)。

![565469b95a830f2e2b723d58c900e089.png](https://gitee.com/Jinxizhen/pic_resource/raw/master/images/565469b95a830f2e2b723d58c900e089.png)



响应式和自适应的区别，国内外各种社区都有很多的讨论，甚至争议。个人认为两种方式更多是一种UI设计层面的区别。技术实现层面，区别并不明显。

响应式。屏幕适配无粒度区分，同一设备上做宽度变化时，内容布局无缝圆滑变化；技术实现通常为，一套代码适配所有屏幕。

自适应。屏幕适配有粒度区分，原则上不做过渡态的 UI 设计，同一设备上做宽度变化时，内容布局卡顿式梯级变化；技术实现通常为，多个屏幕对应多套代码。（演示如下图）

![ef727d827a57e46070ebdece3b605978.gif](https://gitee.com/Jinxizhen/pic_resource/raw/master/images/ef727d827a57e46070ebdece3b605978.gif)



## 响应式设计

**响应式设计**方案是一种**通用型设计**，只开发一套代码，同时运行在PC端和移动端，页面本身能够根据不同的浏览器尺寸来自动适应屏幕，显示为不同的样式。一套代码适应PC端和移动端，这种页面叫做响应式布局页面。

浏览这类站点时，随着屏幕的缩小，你会看到页面模块的布局结构在伸缩、流动或显隐变化，文字图片等主体内容在布局容器内流动填充、其大小也一直在做梯级变化。

使用技术：媒体查询 @media

有GitHub、华为官网，苹果官网，三星官网等，这些都是能在手机端浏览器和PC端浏览器运行的响应式网站。

响应式开发的特点：

- 可以适应几乎所有设备的屏幕
- 更少维护开发一个独立的移动网站，会增加你的工作负担
- 页面加载的代码多了，导致文件增大，影响加载速度
- 制作麻烦， 需要花很大精力去调兼容性问题
- 局限性，对于响应式，局限性较大，不适合一些大型的门户网或者电商网站

## 自适应设计

为了在特定设备上实现最好的用户体验，越来越多的产品，开始针对特定屏幕设计固定的 UI，绝大多数移动端产品都有了区分于 PC 的专门的m站。

**自适应设计**（**原生移动web开发**）是一种**专用型设计**，针对每一个端**PC端**页面和**移动端**页面分别开发，PC端加载PC端的页面，移动端加载移动端的页面。

使用技术：当用户请求页面时，服务器先根据浏览器请求的 user-agent 判断用户的设备类型，然后根据设备类型返回对应的页面，PC端一套代码，移动端一套代码。

有淘宝触屏版、京东手机版、苏宁手机版、携程手机版、小米手机版等等，这些都是在手机端浏览器运行的应用程序。

移动web应用程序的特点：

- 通常移动web应用程序都是以m(Mobile)开头的站点，例如 淘宝：m.taobao.com；京东：m.jd.com
- 通常移动web应用都是只运行在手机端，设计功能也是符合手机的操作
- 页面都相对比较简洁，使用起来比较方便

## 两种方式的对比和应用场景

自适应设计（原生移动web开发）： 要针对每个端都写1个页面，开发维护效率低，但是由于针对性强，只有对应端需要的代码 代码冗余少，运行效率高，应用在一些老网站 PC已经上线，单独开发移动端，写2套代码，对页面加载性能要求高使用原生移动web开发。比如：电商、直播、视频、聊天等。

响应式开发： 一个页面适配多个终端，开发效率高，维护效率高，但是由于代码都在一个页面会造成冗余，所以运行的效率低。应用在一些新建的网站，同时把2个端都做完，快速上线，对页面加载性能要求不高，使用响应式 开发，比如：新闻网站、官网、活动页面等。

![img](https://gitee.com/Jinxizhen/pic_resource/raw/master/images/1319779-20180720171316195-1773077021.png)

## 结论

移动web开发和响应式开发都是现在主流的开发模式。使用流式布局等，来适配不同设备由于终端设备的多样化，新建站的站点会优先用响应式来开发。

# 移动端适配方案

移动端web页面的开发，由于手机**屏幕尺寸**、**分辨率**不同，或者需要考虑**横竖屏**问题，为了使得web页面在不同移动设备上具有相适应的展示效果，需要在开发过程中使用合理的适配方案来解决这个问题。

早期网页设计采用**静态布局**，通过`<meta>`标签中的`applicable-device`应用设备标识识别移动设备，即`<meta name = 'applicable-device' content = 'mobile'>`，在`<meta>`标签中的`viewport`标签中设置`width`，通过`js`动态修改标签的`initial-scale`使得页面等比缩放，刚好占满整个屏幕。一些文章中有提到静态布局中页面各个元素采用`px`为单位，这种方案实现简单，不存在兼容性问题，但用户体验很不友好。

后面出现**流式布局**，使用百分比`%`定义宽度，高度使用`px`固定，根据可视区域大小实时进行尺寸调整，通常使用`max-width/min-width`控制尺寸范围过大或者过小。这种方案实现比较简单，但在大屏手机或横竖屏切换场景下可能会导致页面元素被拉伸变形，字体大小无法随屏幕大小发生变化。

顺应不同页面字体大小展现问题，出现了**弹性布局**。这种布局方案下，包裹文字的元素的尺寸采用`em/rem`为单位，页面主要划分区域的尺寸依据情况使用`px`、百分数或者`em/rem`。

上面的这几种方案下，页面元素的大小按照屏幕分辨率进行适配调整，但是整体布局不变，对于**响应式web设计**，网页布局会随着访问它的视口及设备的不同呈现不同的样式，在实现上可能会以上多种方案的结合，同时搭配 **媒体查询** 技术使用，使得一个页面在多个终端 (PC, mobile, pad) 呈现满意效果 。

## 移动端跨屏适配中的 viewport

移动端的屏幕宽度差距比较小（4-8 英寸），UI 页面通常也会保持一致的布局方式，只是文字、图标、大图片等可能会根据业务需要做一些定制化的处理。

注：Pad 设备虽然也是移动设备，但是因为屏幕足够宽，所以现在多数产品（如某宝）的方案都是访问 PC 站点了。

移动端跨屏适配的需求，自适应设计主要有两类：

- **布局伸缩式**（布局伸缩，内容大小固定或梯级变化）；

- **等比缩放式**（布局和内容完全等比例缩放）

- **混合布局**

实际业务中的适配需求可能是区分页面模块使用混合布局，对应的技术方案一般也是对视口(viewport)、媒体查询(media queries)、单位(px/%/rem/vw)的组合使用。

## 布局伸缩式

### 需求描述

如图，布局伸缩式适配需求，常见于排版比较简单的信息流展示类业务。有拉勾网、Boss直聘等

其布局特点一般为横向伸缩，竖向**高度固定**或由内容填充决定；文字图标等网页内容一般会固定大小，且在宽屏窄屏上的视觉大小保持一致。

![4d1fcf5d74577c1b98dcd291f97515df.gif](https://gitee.com/Jinxizhen/pic_resource/raw/master/images/4d1fcf5d74577c1b98dcd291f97515df.gif)

### 技术方案

设置 viewport 宽度为 device-width，以保证 px 为单位取值的一些文字图标等网页内容视觉大小符合预期且宽窄屏大小一致。（css 中的 px 取值需按一倍屏 UI 稿来写）；

布局方案灵活使用相对单位%/float/flex 等，以保证布局的横向伸缩和容器内各元素的大小间距符合预期；

组合包裹相关元素，并相对某一方向做定位，以保证宽度变化时的定位稳定。

## 等比缩放式

### 需求描述

如图，等比缩放式适配需求，广泛应用于各种产品类、运营类等业务场景。有腾讯网(rem)、B站(vw)等

其布局特点简单粗暴，就是根据屏幕宽度整个页面等比缩放。

![c77c1f7c10bbce4c279edda4d9bb47fd.gif](https://i.loli.net/2021/11/23/rfR2TFgbyHnpGio.gif)



### 技术方案 - rem

rem 是 CSS3 新增的相对于根元素 html 的 font-size 计算值的大小的倍数单位。早期的移动端等比缩放的适配方案都是基于 rem。

- 设置 viewport 宽度为 device-width 或其他固定值，以得到 px 为单位的文字、图标或边线等期望的渲染效果
- css 单位使用 rem，js 根据 viewport 宽度以及 css 中 rem 的换算系数，动态计算并设置 html 根节点 font-size，以实现整个页面内容的等比例缩放

注：一些文本段落展示类的需求，UI 设计师可能会希望宽屏比窄屏在一行内可以展示更多的文字。这时就需要引入媒体查询，并且对字号使用 px 单位做特殊处理。

rem 为基础的动态适配方案

设：横向满屏的 rem 个数预定为 remCount，标注稿总宽度 px 为 uiWidth，标注稿内某元素宽度为 uiEleWidth。

那么：

- 设计稿中 1rem 表示的 px 数 uiPX1rem = uiWidth/remCount
- CSS 中某元素 rem 的值 cssEleWidth= uiEleWidth/uiPX1rem
- JS 中根节点的 fontSize = document.documentElement.clientWidth/remCount

说到rem不得不提[flexible](https://github.com/amfe/lib-flexible)，在2014年之前，视口单位(vw、vh)还没得到个浏览器厂商的支持，淘宝的前端团队借助js 控制viewport 的能力，使用rem 单位，去模拟出vw的特性来实现整个页面内容的等比例缩放，在项目中引入flexible后，我们在页面上统一使用rem单位来布局页面。

### 技术方案 - viewport units

viewport units（视口单位），是 iOS8+、Android4.4+ 开始支持的新的长度单位，包括：vw/vh/vmin/vmax。目前已被广泛应用于移动端适配中。

1vw 即表示当前视口宽度的 1%，我们可以利用这一点替代“rem+根节点 font-size”的等比缩放实现。

举个例子，750px 的 UI 稿中，宽度 75px 的按钮，在 css 中的宽度描述即为：width:10vw。

其他技术细节同上。

### 技术方案 - viewport meta only

看起来viewport units方案是目前最简单可行的方案了，UI 稿里的标注直接都转换成 vw 单位就可以了，html 中不需要做任何 js 处理。

那么，是不是还可以更简单一些呢？

回到本文最初的起点，`<meta name="viewport">`的引入是为了支持开发者定制视口的大小。

我们做的 ui 稿中的 px 到 css 的 rem、vw 这些单位的转换，核心目的就是在不同的屏幕上高保真还原设计稿。

那么，我们直接把 web 容器视口的大小定为和 UI 稿一样的 px 大小不就可以了？

是的，不再需要做任何单位的转换。

而且，完美实现 UI 稿的高保证还原。完全不需要担心什么 0.5px 细线问题。

然而，当前前端圈内viewport meta only方案并未成为主流方案，个人认为，原因主要是——业务场景中，存在非等比缩放类的适配需求，比如布局只要横向伸缩、字号要 px 固定等。

如果 100%确定当前业务可以完全等比缩放式适配，那么，强烈推荐使用该方案。

注：Android 的 webview 默认未开启 viewport meta 支持，需要手动开启webView.settings.useWideViewPort = true;

# 移动端适配方案对比

## 流式布局

流式布局，就是百分比布局，也称非固定像素布局。比如携程网

### 原理

> 使用 **百分比%** 定义 **宽度**，**高度** 用**`px`**固定，根据可视区域实时尺寸进行调整，尽可能适应各种分辨率，通常使用`max-width`/`min-width`控制尺寸范围过大或者过小。

下表是子元素不同属性设置百分比的依据

| 属性                            | 设置参考                                                     |
| :------------------------------ | :----------------------------------------------------------- |
| `height`/`width`                | 基于子元素的直接父元素，`width`相对于父元素的`width`，`height`相对于父元素的`height` |
| `top`/`bottom` 和`left`/`right` | 相对于直接非`static`定位的父元素的`height`/`width`           |
| `padding`/`margin`              | 不论是垂直方向或者是水平方向，都相对于直接父亲元素的`width`，与父元素的`height`无关。 |
| `border-radius`                 | 相对于自身的宽度                                             |

### 优势

> 原理简单，不存在兼容性问题

### 不足

> - 如果屏幕尺度跨度太大，相对设计稿过大或者过小的屏幕不能正常显示，在大屏手机或横竖屏切换场景下可能会导致页面元素被拉伸变形，字体大小无法随屏幕大小发生变化。
> - 设置盒模型的不同属性时，其百分比设置的参考元素不唯一，容易使布局问题变得复杂+

## rem方案

### 原理

> **rem**是相对长度单位，rem是相对于**根元素**`font-size`计算值的。根据 **屏幕宽度** 设置`html`标签的`font-size`，在布局时使用 **rem** 单位布局，这样就可以保证在页面大小变化时，达到自适应的目的，是 **弹性布局** 的一种实现方式。

> **实现过程：**  首先获取文档根元素和设备`dpr`，设置 **rem**，在`html`文档加载和解析完成后调整`body`字体大小； 在页面**缩放 / 回退 / 前进**的时候， 获取元素的内部宽度 (不包括垂直滚动条，边框和外边距)，重新调整 **rem** 大小。

rem的布局不得不提flexible，flexible方案是阿里早期开源的一个移动端适配解决方案，引用flexible后，我们在页面上统一使用rem来布局。

flexible.js： https://github.com/amfe/lib-flexible/blob/master/src/flexible.js

我们只需要给设计稿的px转换成对应的rem单位即可：

> **实现方法：**用 **css** 处理器或 **npm** 包将页面 **css** 样式中的`px`自动转换成 **rem**。在整个 **flexible** 适配方案中，文本使用`px`作为单位，使用`[data-dpr]`属性来区分不同`dpr`下的文本字号。由于手机浏览器对字体显示最小是`8px`，因此对于小尺寸文字需要采用`px`为单位，防止通过 **rem** 转化后出现显示问题。[手机淘宝](https://main.m.taobao.com/index.html) 中的字体使用`px`为单位，[腾讯新闻](https://xw.qq.com/#news)中的字体使用`rem`为单位。

### 优势

> 兼容性好

- ios: 6.1系统以上都支持
- android: 2.1系统以上都支持
- 大部分主流浏览器都支持

> 相较于之前的静态布局和百分比方案，页面不会因为伸缩发生变形，自适应效果更佳。

### 不足

> - **不是纯css移动适配方案，需要引入js脚本** 在头部内嵌一段 `js`脚本 **监听分辨率的变化来动态改变根元素的字体大小**，`css`样式和 `js` 代码有一定 **耦合性**，并且必须将改变`font-size`的代码放在 **css** 样式之前。
> - **小数像素问题**，浏览器渲染最小的单位是像素，元素根据屏幕宽度自适应，通过 **rem** 计算后可能会出现小数像素，浏览器会对这部分小数四舍五入，按照整数渲染。浏览器在渲染时所做的摄入处理只是应用在元素的尺寸渲染上，其真实占据的空间依旧是原始大小。也就是说如果一个元素尺寸是 `0.625px`，那么其渲染尺寸应该是 `1px`，空出的 `0.375px` 空间由其临近的元素填充；同样道理，如果一个元素尺寸是 `0.375px`，其渲染尺寸就应该是`0`，但是其会占据临近元素 `0.375px` 的空间。会导致：缩放到低于`1px`的元素时隐时现（解决办法：指定最小转换像素，对于比较小的像素，不转换为 **rem** 或 **vw**）；两个同样宽度的元素因为各自周围的元素宽度不同，导致两元素相差`1px`；宽高相同的正方形，长宽不等了；`border-radius: 50%` 画的圆不圆。
> - **Android 浏览器下 line-height 垂直居中偏离的问题**。常用的垂直居中方式就是使用line-height，这种方法在Android设备下并不能完全居中。
> - **cursor: pointer 元素点击背景变色的问题**，对添加了cursor:pointer属性的元素，在移动端点击时，背景会高亮。为元素添加`tag-highlight-color:transparent` 属性可以隐藏背景高亮。

当然，这个方案只是个过渡方案，为什么说是过渡方案

因为当年viewport在低版本安卓设备上还有兼容问题，而vw，vh还没能实现所有浏览器兼容，所以flexible方案用rem来模拟vmin来实现在不同设备等比缩放的“通用”方案，之所以说是通用方案，是因为他这个方案是根据设备大小去判断页面的展示空间大小即屏幕大小，然后根据屏幕大小去百分百还原设计稿，从而让人看到的效果(展示范围)是一样的，这样一来，苹果5 和苹果6p屏幕如果你按照设计稿还原的话，字体大小实际上不一样，而人们在一样的距离上希望看到的大小其实是一样的，本质上，**用户使用更大的屏幕，是想看到更多的内容，而不是更大的字**。

所以，这个用缩放来解决问题的方案是个过渡方案，注定时代所淘汰

## vh/vw方案

### 原理

**视口**是浏览器中用于呈现网页的区域，移动端的视口通常指的是 **布局视口**

- **vw** : **1vw** 等于 **视口宽度** 的 **1%**
- **vh** : **1vh**  等于 **视口高度** 的 **1% **
- **vmin** : 选取 **vw** 和 **vh** 中 **最小** 的那个
- **vmax** : 选取 **vw** 和 **vh** 中 **最大** 的那个

使用 **css** 预处理器把设计稿尺寸转换为 **vw** 单位，包括 **文本**，**布局高宽**，**间距** 等，使得这些元素能够随视口大小自适应调整。

vh和vw方案和rem类似也是相当麻烦需要做单位转化，而且px转换成vw不一定能完全整除，因此有一定的像素差。

以`1080px`设计稿为基准，转化的计算表示为：

```javascript
// 以1080px作为设计稿基准
$vw_base: 1080
@function vw($px) {
    @return($px / 1080) * 100vw
}
```

### 优势

> - 纯 **css** 移动端适配方案，不存在脚本依赖问题
> - 相对于 **rem** 以**根元素字体大小的倍数** 定义 **元素大小**，逻辑清晰简单，视口单位依赖于视口的尺寸 `"1vw ＝ 1/100 viewport width"`，根据 **视口尺寸的百分比** 来定义 **元素宽度**

### 不足

> - 存在一些兼容性问题，Android4.4以下不支持

## rem+vw/vh方案

### 原理

> **vw/vh** 方案能够实现宽度和高度的自适应，并且逻辑清晰，由于其被支持得较晚，所以存在一定的兼容性问题。将 **vw/vh** 方案与 **rem** 方案相结合，**给根元素设置随视口变化的vw单位**，可以通过`postcss-plugin-vwtorem`将其转换。具体的**计算过程**为：

> 对于`1080px`宽的设计稿，设置默认根字号的大小为`100px`，那么设计稿中`1px`对应的是 `100vw/1080 = 0.0925926vw`，并且 `1rem = 100px`，也就可以得到`1rem = 9.256926vw`

> 同时可以使用媒体查询限制根元素的最大最小值，实现对页面的最大最小宽度限制，对用户的视觉体验更好。

### 实用性

> **rem** 弹性布局方式作为移动端web页面适配方法，后期从 **rem** 过渡到 **vw** ，只需要通过 **改变根元素大小的计算方式** 不需要其他处理。**vw** 将会成为一种更好的适配方式，目前由于兼容性的原因得不到广泛应用。**rem+vw/vh** 不存在 **vw/vh** 的兼容性问题，可以成为由 **rem** 向 **vw/vh** 转变的一种过渡方案。

## px+vw/vh/vmax/vmin+flex

px为主，vw/vh/vmax/vmin为辅，搭配一些flex（推荐）

之所以推荐使用此种方案，是由于我们要去考虑用户的需求，**用户之所以去买大屏手机，不是为了看到更大的字，而是为了看到更多的内容**，这样直接使用px是最明智的方案，使用vw，rem等布局手段无可厚非，但是，flex这种弹性布局大行其道的今天，如果如果还用这种传统的思维去想问题显然是有两个原因（个人认为px是最好的，可能有大佬，能用vw，或者rem写出精妙的布局，也说不准）：

- 为了偷懒，不愿意去做每个手机的适

- 不愿意去学习新的布局方式，让flex等先进的布局和你擦肩而过

## 基于媒体查询的响应式设计

**响应式设计** 使得一个网站同时适配 **多种设备** 和 **多个屏幕**，让网站的布局和功能随用户的使用环境（屏幕大小、输出方式、设备/浏览器能力而变化），使其视觉合理，交互方式符合习惯。如使得内容区块可伸缩与自由排布，边距适应页面尺寸，图片适应比例变化，能够自动隐藏/部分显示内容，能自动折叠导航和菜单。

### 原理

> 主要实现是通过 **媒体查询**，通过给不同分辨率的设备编写不同的样式实现响应式布局，用于解决不同设备不同分辨率之间兼容问题，一般是指PC、平板、手机设备之间较大的分辨率差异。实现上不局限于具体的方案，通常结合了 **流式布局** `+` **弹性布局** 方案。比如给小屏幕手机设置`@2x`图，为大屏手机设置`@3x`图

```css
@media only screen and (min-width: 375px){
    样式1
}
@media only screen and (min-width: 750px){
    样式2
}
```

### 优势

> - 能够使网页在不同设备、不同分辨率屏幕上呈现合理布局，不仅仅是样式伸缩变换
> - 可以向用户提供友好的Web界面，因为它可以适应几乎所有设备的屏幕

### 不足

> - 要匹配足够多的设备与屏幕，一个web页面需要多个设计方案，工作量比较大
> - 通过媒体查询技术需要设置一定量的断点，到达某个断点前后的页面发生显著变化，用户体验不太友好
> - 页面加载的代码多了，导致文件增大，影响加载速度
> - 在响应式设计中，图片、视频等资源一般是统一加载的，这就导致在低分辨率的机子上，实际加载了大于它的显示要求的图片或视频，导致不必要的流量浪费，影响加载速度
> - 局限性，对于响应式，局限性较大，不适合一些大型的门户网或者电商网站，一般门户网或电商网站一个界面内容较多，而响应式最忌讳较多内容，代码过多会影响运行速度

# 移动端适配流程

1. 在head 设置width=device-width的viewport

2. 在css中使用px

3. 在适当的场景使用flex布局，或者配合vw进行自适应

4. 在跨设备类型的时候（pc <-> 手机 <-> 平板）使用媒体查询

5. 在跨设备类型如果交互差异太大的情况，考虑分开项目开发

# 总结

对于上述的各种移动端web页面自适应方案来说，都存在着一些优势和不足。对于国内的一些网站，通过查看网页源代码发现，它可能不是某一种方案的单独使用，而是几种方案的结合。一个页面上，元素的宽度设置上有百分比，也有`rem`，字体的样式中有`rem`，有`em`，也有固定大小的`px`；在屏幕宽度过大时不再缩放，也会用到媒体查询，并且响应式设计更多地可能是针对不同设备间的自适应。对于移动端web页面的自适应方案来说，现在用的比较多的是`rem`，逐渐向`vw/vh`发展，而`rem+vw/vh`则是作为`vw/vh`向后兼容的一种过渡，CSS3的弹性布局在页面中用到的也越来越多。

# 参考

- [深入浅出移动端适配 - 掘金](https://juejin.cn/post/6844903951012200456)

- [关于移动端适配,你必须知道的 - 掘金](https://juejin.cn/post/6844903845617729549)

- [移动Web手册](http://zj.ddooo.com/ydwebsc_100638.rar?key=a752997777386b673d7c07c61f11f5d7)

- [关于各种像素概念和前端长度单位的理解](https://linjingyi.cn/posts/3680799e.html)
