# ES Module

## 解析流程

ES Module 是如何被浏览器解析并且让模块之间相互引用的呢？

![image.png](https://s2.loli.net/2023/09/11/jDxMw4VSAQWR5Yv.png)

ES Module 的解析过程可以分为三个阶段：

- ==阶段一==：构建，根据地址来查找 js 文件，并且下载，将其解析成模块记录；
- ==阶段二==：实例化，对模块记录进行实例化，并且分配内存空间，解析模块的导入和导出语句，把模块语句指向对应的内存地址；
- ==阶段三==：运行，运行代码，计算值，并且将值填充到内存地址中；



比如之前说的，对于 util.js 的导入的过程，首先，会根据 util 的地址将这个文件下载过来，并将这个文件给抽象成一个 ==模块记录==对象，这个对象进行实例化，这个实例化的过程主要用于==解析该模块那些用来导出，那些用来导入==，这个时候是没有执行代码的，而真正的赋值代码是在阶段三才开始执行的。

事实上，每个模块都是有环境记录的，就像每个函数都有一个环境记录一样，在代码执行之前，环境记录是记录着要导出那些东西的（默认没有赋值），等到开始运行代码的时候，才会开始赋值。